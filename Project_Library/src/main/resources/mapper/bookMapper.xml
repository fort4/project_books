<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.fort4.mapper.BookMapper">
	<!-- MyBatis에 camelCase 매핑 허용 대신 alias 사용 -->
    <select id="getAllBooks" resultType="com.fort4.dto.BookDTO">
        SELECT * FROM books
   		ORDER BY pub_date DESC
    </select>
    
    <select id="getBookById" resultType="com.fort4.dto.BookDTO">
	    SELECT * FROM books
	    WHERE book_id = #{bookId}
	</select>
    
    <update id="returnBook">
	    UPDATE rental
	    SET is_returned = true,
	        return_date = NOW()
	    WHERE rental_id = #{rentalId};
	
	    UPDATE books
	    SET is_rented = false
	    WHERE book_id = (
	        SELECT book_id FROM rental WHERE rental_id = #{rentalId}
	    );
	</update>
	
	<update id="updateIsRentedTrue">
	    UPDATE books SET is_rented = true WHERE book_id = #{bookId}
	</update>
	
	<update id="updateIsRentedFalse">
	    UPDATE books SET is_rented = false WHERE book_id = #{bookId}
	</update>
	
	<select id="searchBooks" resultType="com.fort4.dto.BookDTO">
	    SELECT *
	    FROM books
	    WHERE title LIKE CONCAT('%', #{keyword}, '%')
	       OR author LIKE CONCAT('%', #{keyword}, '%')
	    ORDER BY pub_date DESC
	</select>
	
	<insert id="insertBook">
	    INSERT INTO books (title, author, publisher, pub_date, image_url, is_rented)
	    VALUES (#{title}, #{author}, #{publisher}, #{pubDate}, #{imageUrl}, false)
	</insert>
	
	
    
    
</mapper>
