<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.fort4.mapper.RentalMapper">

	<insert id="insertRental">
	    INSERT INTO rental (book_id, username, rental_date, is_returned)
	    VALUES (#{bookId}, #{username}, NOW(), false)
	</insert>
	
	<select id="countNotReturned" resultType="int">
	    SELECT COUNT(*) FROM rental WHERE book_id = #{bookId} AND is_returned = false
	</select>
	
	<select id="getRentalByBookIdAndUsername" resultType="com.fort4.dto.RentalDTO">
	    SELECT * FROM rental
	    WHERE book_id = #{bookId}
	      AND username = #{username}
	      AND is_returned = false
	</select>
	
	<update id="returnBook">
	    UPDATE rental
	    SET is_returned = true,
	        return_date = NOW()
	    WHERE rental_id = #{rentalId}
	</update>


</mapper>
